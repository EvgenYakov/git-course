<!-- Игра «Жизнь Конвея - это простая симуляция, создающая искусственную
«жизнь на сетке, каждая клетка которой может быть живой или мертвой.
Для каждого поколения (хода) выполняются следующие правила.
1:1 Любая живая клетка, у которой меньше двух или больше трех живых
соседей, умирает.
1:1 Любая живая клетка, у которой два или три живых соседа, живет в следующем поколении.
1:1 Любая мертвая клетка, у которой ровно три живых соседа, становится
живой клеткой.
Соседней считается любая смежная ячейка, в том числе по диагонали.
Обратите внимание, что данные правила применяются ко всей сетке сразу,
а не по одному квадрату за раз. Это означает, что подсчет соседей основан
на ситуации в начале поколения и изменения, происходящие с соседними
ячейками во время жизни поколения, не должны влиять на новое состояние
данной ячейки.
Реализуйте эту игру, используя любую структуру данных, которую считаете подходящей.
Для того чтобы изначально заполнить сетку случайными данными, примените Math.random.
Отобразите игру в виде сетки полей флажков, рядом с которой находится кнопка,
позволяющая перейти к следующему поколению.
Когда пользователь устанавливает или снимает флажки, их изменения должны учитываться
при вычислении следующего поколения. -->

<!doctype html>
<script src="code/chapter/18_http.js"></script>

<div id="grid"></div>
<button id="next">Next generation</button>

<script>
    let spclv = document.querySelector("#grid");
    let btnnext = document.querySelector("#next");
    let chkboxes = [];
    let arr = [];

    for (let i = 0; i < 15; i++) {
        for (let j = 0; j < 15; j++) {
            let check = document.createElement("input");
            check.type = "checkbox";
            check.name = `${i},${j}`;
            spclv.appendChild(check);
            chkboxes.push(check);
        }
        spclv.appendChild(document.createElement("br"));
    }

    function randomGrid() { // заполнение случайным образом
        let result = {};
        for (let i = 0; i < 15; i++) {
            for (var j = 0; j < 15; j++) {
                result[`${i},${j}`] = (+(Math.random() < 0.3));
            }
        }
        end(result);
    }
    randomGrid();

    // основная функциявс
    function scanSpace() {
        /* т.к количество соседей не может превышать 6, то для удобства лучше помечать
        пустые клетки 7 это поможет в подсчете соседей  
        */
        for (let i = 0; i < 15 * 15; i++) {
            if (chkboxes[i].checked) {
                arr[chkboxes[i].name] = 1;  // клетка отмечена
            }
            else {
                arr[chkboxes[i].name] = 7;  // клетка которая не отмечена 
            }
        }

        let arrc = colNeigh(arr); // сетка с количество соседей
        let endspace = gameKon(arrc); // сетка с конечным расположением чекбоксов

        end(endspace);
    }

    //------- вспомогательные функции 
    function colNeigh(arr) {    // функция подсчета соседей 
        // будет возвращать сетку где на каждой клетке написано количество
        // соседей. Eсли клетка не отмечена и у неё есть соседи, то это количество n-7
        for (var i = 0; i < 15; i++) {
            for (var j = 0; j < 15; j++) {
                if (arr[`${i},${j}`] == 1) arr[`${i},${j}`] = 0;

                if (arr[`${i},${j + 1}`] > 0 && arr[`${i},${j + 1}`] < 7) { ++arr[`${i},${j}`]; }
                if (arr[`${i},${j - 1}`] > 0 && arr[`${i},${j - 1}`] < 7) ++arr[`${i},${j}`];
                if (arr[`${i + 1},${j + 1}`] > 0 && arr[`${i + 1},${j + 1}`] < 7) ++arr[`${i},${j}`];
                if (arr[`${i + 1},${j - 1}`] > 0 && arr[`${i + 1},${j - 1}`] < 7) ++arr[`${i},${j}`];
                if (arr[`${i - 1},${j + 1}`] > 0 && arr[`${i - 1},${j + 1}`] < 7) ++arr[`${i},${j}`];
                if (arr[`${i - 1},${j - 1}`] > 0 && arr[`${i - 1},${j - 1}`] < 7) ++arr[`${i},${j}`];
                if (arr[`${i + 1},${j}`] > 0 && arr[`${i + 1},${j}`] < 7) ++arr[`${i},${j}`];
                if (arr[`${i - 1},${j}`] > 0 && arr[`${i - 1},${j}`] < 7) ++arr[`${i},${j}`];
            }
        }
        return arr;
    }

    function gameKon(arrc) { //функция возвращающая массив итогового размещения клеток
        for (var i = 0; i < 15; i++) {
            for (var j = 0; j < 15; j++) {
                if ((arr[`${i},${j}`] < 2 || arr[`${i},${j}`] > 3) && arr[`${i},${j}`] < 7) {
                    arr[`${i},${j}`] = 0;
                }
                else if ((arr[`${i},${j}`] == 2 || arr[`${i},${j}`] == 3) && arr[`${i},${j}`] < 7) {
                    arr[`${i},${j}`] = 1
                }
                else if (arr[`${i},${j}`] == 10) {
                    arr[`${i},${j}`] = 1;
                }
                else arr[`${i},${j}`] = 0;
            }
        }
        return arrc;
    }

    function end(arr) { // включение чекбоксов
        for (var i = 0; i < 15; i++) {
            for (var j = 0; j < 15; j++) {
                if (arr[`${i},${j}`]) {
                    chkboxes[j + i * 15].checked = true;
                }
                else chkboxes[j + i * 15].checked = false;
            }
        }
    }

    btnnext.addEventListener("click", scanSpace);
</script>